<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Account - FixMyHouse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  {% load static %}
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Lexend', 'sans-serif'] },
          colors: {
            primary: '#293272',
            accent: '#EF7153',
          }
        }
      }
    }
  </script>
  <style>
    a { text-decoration: none !important; }
    .btn-primary { @apply bg-primary text-white hover:bg-[#1f2558] px-6 py-2.5 rounded-lg font-medium transition; }
    .btn-accent { @apply bg-accent text-white hover:bg-[#d75f44] px-6 py-2.5 rounded-lg font-medium transition; }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-blue-50">

  {% include 'renter/home/navbar.html' %}

  <main class="flex-grow container mx-auto px-4 py-6 sm:px-6 lg:px-8">
    <div class="bg-white shadow-xl rounded-2xl overflow-hidden">

      <!-- Mobile: Profile Header + Horizontal Tabs -->
      <div class="lg:hidden">
        <div class="bg-gradient-to-br from-primary to-blue-800 text-white p-6 text-center">
          <div class="relative inline-block">
            <img id="profilePreviewMobile"
                 src="{% if renter.profile_picture %}{{ renter.profile_picture.url }}{% else %}{% static 'img/avatar_placeholder.png' %}{% endif %}"
                 class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg mx-auto" alt="Profile" />
          </div>
          <h2 class="mt-4 text-xl font-bold">{{ user.get_full_name }}</h2>
          <p class="text-sm opacity-90 bg-white/20 px-3 py-1 rounded-full inline-block mt-2">{{ user.email }}</p>
        </div>

        <!-- Mobile Tabs (Scrollable) -->
        <div class="flex overflow-x-auto gap-3 px-4 py-4 border-b border-gray-200 scrollbar-hide">
          <button data-section="personalInfo"   class="tab-btn-mobile flex-shrink-0 px-5 py-2.5 text-sm font-medium rounded-xl bg-primary text-white">Personal</button>
          <button data-section="cards"          class="tab-btn-mobile flex-shrink-0 px-5 py-2.5 text-sm font-medium rounded-xl text-gray-700 bg-gray-100">Cards</button>
          <button data-section="addresses"      class="tab-btn-mobile flex-shrink-0 px-5 py-2.5 text-sm font-medium rounded-xl text-gray-700 bg-gray-100">Addresses</button>
          <button data-section="notifications"  class="tab-btn-mobile flex-shrink-0 px-5 py-2.5 text-sm font-medium rounded-xl text-gray-700 bg-gray-100">Notifs</button>
          <button data-section="business"       class="tab-btn-mobile flex-shrink-0 px-5 py-2.5 text-sm font-medium rounded-xl text-gray-700 bg-gray-100">Business</button>
        </div>
      </div>

      <div class="flex flex-col lg:flex-row">
        
        <!-- Desktop Sidebar -->
        <div class="hidden lg:block w-80 bg-gray-50 border-r border-gray-200 p-8">
          <div class="text-center mb-10">
            <img id="profilePreview"
                 src="{% if renter.profile_picture %}{{ renter.profile_picture.url }}{% else %}{% static 'img/avatar_placeholder.png' %}{% endif %}"
                 class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl mx-auto" alt="Profile" />
            <h2 class="mt-4 text-2xl font-bold text-gray-800">{{ user.get_full_name }}</h2>
            <p class="text-sm text-primary bg-blue-100 px-4 py-1.5 rounded-full inline-block mt-2">{{ user.email }}</p>
          </div>
          <nav>
            <ul class="space-y-1">
              <li data-section="personalInfo"   class="nav-item cursor-pointer p-4 rounded-xl font-medium text-gray-700 hover:bg-blue-50 hover:text-primary transition">Personal Information</li>
              <li data-section="cards"          class="nav-item cursor-pointer p-4 rounded-xl font-medium text-gray-700 hover:bg-blue-50 hover:text-primary transition">Cards & Accounts</li>
              <li data-section="addresses"      class="nav-item cursor-pointer p-4 rounded-xl font-medium text-gray-700 hover:bg-blue-50 hover:text-primary transition">Saved Addresses</li>
              <li data-section="notifications"  class="nav-item cursor-pointer p-4 rounded-xl font-medium text-gray-700 hover:bg-blue-50 hover:text-primary transition">Notifications</li>
              <li data-section="business"       class="nav-item cursor-pointer p-4 rounded-xl font-medium text-gray-700 hover:bg-blue-50 hover:text-primary transition">Business Profile</li>
            </ul>
          </nav>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 p-6 lg:p-10">
          <div id="accountContent">

            <!-- Personal Information -->
            <section id="personalInfo" class="account-section">
              <h1 class="text-2xl font-bold text-gray-800 mb-8 hidden lg:block">Personal Information</h1>
              <form method="POST" action="{% url 'renter_account' %}" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                <div class="flex flex-col sm:flex-row items-center gap-6 mb-8 lg:hidden">
                  <img id="profilePreviewForm"
                       src="{% if renter.profile_picture %}{{ renter.profile_picture.url }}{% else %}{% static 'img/avatar_placeholder.png' %}{% endif %}"
                       class="w-28 h-28 rounded-full object-cover border-4 border-gray-200" />
                  <div class="text-center sm:text-left">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Change Profile Picture</label>
                    <input type="file" name="profile_picture" accept="image/*" onchange="previewImage(event)"
                           class="text-sm file:mr-4 file:py-2.5 file:px-5 file:rounded-full file:border-0 file:bg-primary file:text-white hover:file:bg-[#1f2558]" />
                  </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label><input type="text" name="name" value="{{ user.get_full_name }}" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" required /></div>
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label><input type="tel" name="phone" value="{{ renter.phone|default:'' }}" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" /></div>
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label><input type="email" name="email" value="{{ user.email }}" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" /></div>
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                    <select name="gender" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary">
                      <option value="Male" {% if renter.gender == "Male" %}selected{% endif %}>Male</option>
                      <option value="Female" {% if renter.gender == "Female" %}selected{% endif %}>Female</option>
                    </select>
                  </div>
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label><input type="date" name="dob" value="{{ renter.date_of_birth|date:'Y-m-d' }}" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" /></div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Address Line 1</label><input type="text" name="address_line1" value="{{ renter.address_line1|default:'' }}" placeholder="Street, Building" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" /></div>
                  <div><label class="block text-sm font-medium text-gray-700 mb-1">Address Line 2</label><input type="text" name="address_line2" value="{{ renter.address_line2|default:'' }}" placeholder="Apt, Suite, etc." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary" /></div>
                </div>

                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-8">
                  <a href="{% url 'change_password' %}" class="text-primary hover:underline text-sm flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    Change Password?
                  </a>
                  <button type="submit" class="btn-primary">Save Changes</button>
                </div>
              </form>
            </section>

            <!-- Cards & Accounts -->
            <section id="cards" class="account-section hidden">
              <h1 class="text-2xl font-bold text-gray-800 mb-6 hidden lg:block">Cards & Accounts</h1>
              <div class="bg-gradient-to-r from-primary to-blue-700 text-white p-8 rounded-2xl text-center mb-8">
                <p class="text-sm opacity-90">Wallet Balance</p>
                <h2 class="text-4xl font-bold mt-2">AUD 0.00</h2>
                <div class="flex flex-col sm:flex-row justify-center gap-4 mt-6">
                  <button class="bg-white text-primary font-medium py-3 px-8 rounded-xl hover:bg-blue-50 transition">Add Funds</button>
                  <button class="bg-white/20 border border-white/50 font-medium py-3 px-8 rounded-xl hover:bg-white/30 transition">Withdraw</button>
                </div>
              </div>
              <div class="text-center py-20 text-gray-500">
                <p class="text-lg">No cards or bank accounts added yet.</p>
                <button class="mt-6 btn-primary">+ Add Payment Method</button>
              </div>
            </section>

            <!-- Saved Addresses, Notifications, Business (same pattern) -->
            <section id="addresses" class="account-section hidden text-center py-20"><p class="text-gray-600 text-lg">No saved addresses yet.</p><button class="mt-4 btn-primary">+ Add Address</button></section>
            <section id="notifications" class="account-section hidden text-center py-20"><p class="text-gray-600 text-lg">No new notifications.</p></section>
            <section id="business" class="account-section hidden text-center py-20"><p class="text-gray-600 text-lg">Business profile management coming soon.</p></section>

          </div>
        </div>
      </div>
    </div>
  </main>

  {% include 'renter/home/footer.html' %}

  <script>
    function previewImage(event) {
      const file = event.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        document.getElementById('profilePreview').src = url;
        document.getElementById('profilePreviewMobile').src = url;
        document.getElementById('profilePreviewForm').src = url;
      }
    }

    // Tab switching
    document.querySelectorAll('[data-section]').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.dataset.section;

        // Mobile tabs active state
        document.querySelectorAll('.tab-btn-mobile').forEach(t => {
          t.classList.remove('bg-primary', 'text-white');
          t.classList.add('bg-gray-100', 'text-gray-700');
        });
        btn.classList.add('bg-primary', 'text-white');
        btn.classList.remove('bg-gray-100', 'text-gray-700');

        // Desktop sidebar active state
        document.querySelectorAll('.nav-item').forEach(li => {
          li.classList.remove('bg-blue-50', 'text-primary', 'font-semibold');
        });
        document.querySelectorAll(`[data-section="${target}"]`).forEach(el => {
          el.classList.add('bg-blue-50', 'text-primary', 'font-semibold');
        });

        // Show section
        document.querySelectorAll('.account-section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(target).classList.remove('hidden');
      });
    });

    // Default open Personal Info
    document.querySelector('[data-section="personalInfo"]').click();
  </script>

  <style>
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</body>
</html>