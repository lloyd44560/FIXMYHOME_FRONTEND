{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Appliance Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

          {% include 'renter/home/navbar.html' %}
</head>
<body class="bg-light">

<div class="container my-5">


    <h2 style="margin-top:100px;" class="mb-4">Room Appliance Reports</h2>

    <div class="col-md-4">
      <label>Search</label>
      <input type="text" id="searchInput" class="form-control" placeholder="Search anything...">
    </div>
    <br/>
    <br/>
    <form method="GET" class="row g-2 mb-4">
        <div class="col-md-3">
            <label>Room</label>
            <select name="room" class="form-select">
                <option value="">All Rooms</option>
                {% for room in rooms %}
                    <option value="{{ room.id }}" {% if request.GET.room == room.id|stringformat:"s" %}selected{% endif %}>{{ room.room_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label>Brand</label>
            <input type="text" name="brand" class="form-control" placeholder="Brand" value="{{ request.GET.brand }}">
        </div>
        <div class="col-md-3">
            <label>Model / Serial</label>
            <input type="text" name="model_serial" class="form-control" placeholder="Model or Serial" value="{{ request.GET.model_serial }}">
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-outline-primary w-100">Filter</button>
        </div>
        <br/>
        <br/>
        <a style="margin-top: 200px; "  href="{% url 'appliance_report_list' %}" class="btn btn-outline-secondary w-100 mt-2">Reset</a>
    </form>


    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#applianceReportModal">
      Add Appliance Report
    </button>

    <br/>
    <br/>

    <div class="table-responsive">
        <table class="table table-bordered table-striped shadow-sm bg-white">
            <thead class="table-dark">
                <tr>
                    <th>Room</th>
                    <th>Window Size</th>
                    <th>Brand</th>
                    <th>Model / Serial</th>
                    <th>Location</th>
                    <th>Photo</th>
                    <th>Comments</th>
                    <th>Date Created</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}

                    <tr>
                        <td>{{ report.room.room_name }}</td>
                        <td>{{ report.window_height }} x {{ report.window_length }} x {{ report.window_width }}</td>
                        <td>{{ report.brand }}</td>
                        <td>{{ report.model_serial }}</td>
                        <td>{{ report.location }}</td>
                        <!--<td>{{ report.appliance_photo }}</td>-->
                        <td>
                          {% if report.appliance_photo %}
                              <img src="{{ report.appliance_photo.url }}" alt="Photo" class="img-thumbnail" style="width: 100px;">
                          {% else %}
                              <span class="badge bg-secondary">No Image</span>
                          {% endif %}
                        </td>
                        <td>{{ report.comments }}</td>
                        <td>{{ report.created_at|date:"M d, Y" }}</td>
                        <td>
                          <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ report.id }}">
                            Edit
                          </button>
                          <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ report.id }}">
                            Delete
                          </button>
                        </td>

                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">No reports found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>




        <nav>
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
            {% endif %}

            <li class="page-item active">
              <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
              </li>
            {% endif %}
          </ul>
        </nav>
    </div>


    <div class="modal fade" id="applianceReportModal" tabindex="-1" aria-labelledby="applianceReportModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="applianceReportModalLabel">Add Appliance Report</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <!-- Modal Body -->
          <div class="modal-body">
            <!-- Your form or fields go here -->

              <div class="modal-content">
           <form method="POST" enctype="multipart/form-data"  action="{% url 'add_appliance_report' %}" >
                {% csrf_token %}

                <div class="mb-3">
                    <label class="form-label">Room</label>
                    <select name="room" class="form-select" required>
                        <option value="">Select Room</option>
                        {% for room in rooms %}
                            <option value="{{ room.id }}">{{ room.room_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="row g-2">
                    <div class="col">
                        <label>Window Height</label>
                        <input type="number" step="0.01" name="window_height" class="form-control" required>
                    </div>
                    <div class="col">
                        <label>Window Length</label>
                        <input type="number" step="0.01" name="window_length" class="form-control" required>
                    </div>
                    <div class="col">
                        <label>Window Width</label>
                        <input type="number" step="0.01" name="window_width" class="form-control" required>
                    </div>
                </div>

                <div class="mb-3 mt-3">
                    <label>Brand</label>
                    <input type="text" name="brand" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label>Model / Serial</label>
                    <input type="text" name="model_serial" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label>Location</label>
                    <input type="text" name="location" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label>Comments</label>
                    <textarea name="comments" class="form-control"></textarea>
                </div>

                <div class="mb-3">
                    <label>Appliance Photo</label>
                    <input type="file" name="appliance_photo" class="form-control">
                </div>

                <button type="submit" class="btn btn-success">Save Report</button>
                <a href="{% url 'appliance_report_list' %}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
          </div>
        </div>
      </div>
    </div>



    {% for report in reports %}
    <div class="modal fade" id="editModal{{ report.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ report.id }}" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form method="POST" enctype="multipart/form-data" action="{% url 'edit_appliance_report' report.id %}">
            {% csrf_token %}
            <div class="modal-header bg-warning text-dark">
              <h5 class="modal-title" id="editModalLabel{{ report.id }}">Edit Appliance Report</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">

              <div class="mb-3">
                <label class="form-label">Room</label>
                <select name="room" class="form-select" required>
                  {% for room in rooms %}
                    <option value="{{ room.id }}" {% if room.id == report.room.id %}selected{% endif %}>{{ room.room_name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="row g-2">
                <div class="col">
                  <label>Window Height</label>
                  <input type="number" step="0.01" name="window_height" class="form-control" value="{{ report.window_height }}" required>
                </div>
                <div class="col">
                  <label>Window Length</label>
                  <input type="number" step="0.01" name="window_length" class="form-control" value="{{ report.window_length }}" required>
                </div>
                <div class="col">
                  <label>Window Width</label>
                  <input type="number" step="0.01" name="window_width" class="form-control" value="{{ report.window_width }}" required>
                </div>
              </div>

              <div class="mb-3 mt-3">
                <label>Brand</label>
                <input type="text" name="brand" class="form-control" value="{{ report.brand }}" required>
              </div>

              <div class="mb-3">
                <label>Model / Serial</label>
                <input type="text" name="model_serial" class="form-control" value="{{ report.model_serial }}" required>
              </div>

              <div class="mb-3">
                <label>Location</label>
                <input type="text" name="location" class="form-control" value="{{ report.location }}" required>
              </div>

              <div class="mb-3">
                <label>Comments</label>
                <textarea name="comments" class="form-control">{{ report.comments }}</textarea>
              </div>

              <div class="mb-3">
                <label>Replace Appliance Photo</label>
                <input type="file" name="appliance_photo" class="form-control">
                {% if report.appliance_photo %}
                  <img src="{{ report.appliance_photo.url }}" class="mt-2" style="width: 100px;">
                {% endif %}
              </div>

            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-warning">Update</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>



     <div class="modal fade" id="deleteModal{{ report.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ report.id }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="POST" action="{% url 'delete_appliance_report' report.id %}">
            {% csrf_token %}
            <div class="modal-header bg-danger text-white">
              <h5 class="modal-title" id="deleteModalLabel{{ report.id }}">Confirm Deletion</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete "<strong>{{ report.appliance_name }}</strong>"?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-danger">Yes, Delete</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}







</div>





<div class="mt-auto">
        {% include 'renter/home/footer.html' %}
    </div>
</body>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('searchInput');
    const tableRows = document.querySelectorAll('table tbody tr');

    searchInput.addEventListener('keyup', function () {
      const query = searchInput.value.toLowerCase();

      tableRows.forEach(row => {
        const rowText = row.innerText.toLowerCase();
        if (rowText.includes(query)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });
  });
</script>


</html>
