<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome Home - FixMyHome</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <!-- ✅ USE Bootstrap 5 only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

            {% include 'renter/home/navbar.html' %}

</head>

{% load static %}
<body class="bg-gray-50">


<!-- Tabs Navigation -->


<!-- Tabs Content -->
<div class="tab-content" id="mainTabsContent">
  <div class="tab-pane fade show active" id="properties" role="tabpanel" aria-labelledby="properties-tab">
    <!-- Property Table Section (injected from template) -->

  </div>
  <div class="tab-pane fade" id="minimum-standard-reports" role="tabpanel" aria-labelledby="standards-tab">
    <!-- Minimum Standard Report Section (injected from template) -->

  </div>
</div>


    <!-- Hero Section with Background -->

<section class="relative flex items-center justify-center px-8 py-12 bg-cover bg-center bg-no-repeat min-h-[60vh]"
    style="background-image: url('{% static 'renter/images/RENTER_BG.jpg' %}');">

    <!-- Strong Dark Overlay -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

    <!-- Text Container -->
    <div class="relative z-10 max-w-3xl mx-auto text-left">
        <h2 class="text-4xl md:text-5xl font-bold mb-4 text-white drop-shadow-2xl">
            Welcome Back {{ user.first_name }}!
        </h2>
        <p class="text-white text-lg md:text-xl mb-6 drop-shadow-2xl">
            Quickly report maintenance issues, track requests, and manage your property with ease.
        </p>
        <a href="#" class="inline-block bg-blue-600 text-white py-3 px-6 rounded-full shadow hover:bg-blue-700 transition text-base font-semibold">
            Get Started
        </a>
    </div>

</section>
    <!-- Features Section -->
    <section class="grid md:grid-cols-3 gap-6 px-8 my-16">
      <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
        <h3 class="text-xl font-bold text-blue-600 mb-2">Manage Properties</h3>
        <p class="text-gray-600 mb-4">Easily create and track your maintenance requests. Keep all your property details organized and accessible anytime.</p>
        <a href="/properties/" class="text-blue-600 hover:underline">Manage your properties →</a>
      </div>
      <!--<div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">-->
      <!--  <h3 class="text-xl font-bold text-blue-600 mb-2">View My Agents</h3>-->
      <!--  <p class="text-gray-600 mb-4">Monitor the status of all your service requests. Stay connected with your agents and get real-time updates.</p>-->
      <!--  <a href="#" class="text-blue-600 hover:underline">Manage linked agents →</a>-->
      <!--</div>-->
      <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
        <h3 class="text-xl font-bold text-blue-600 mb-2">Maintenance Requests</h3>
        <p class="text-gray-600 mb-4">Manage your maintenance requests. Assign tasks, track progress, and ensure everything gets done on time.</p>
        <a href="/jobs/" class="text-blue-600 hover:underline">Manage your maintenance requests →</a>
      </div>
      <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
        <h3 class="text-xl font-bold text-blue-600 mb-2">Condition Reports</h3>
        <p class="text-gray-600 mb-4">Easily create and track your maintenance requests. Document the state of rooms before and after leasing.</p>
        <a href="/condition-reports/" class="text-blue-600 hover:underline">Manage your condition reports →</a>
      </div>
    </section>

    <section class="grid md:grid-cols-3 gap-6 px-8 my-16">

      <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
        <h3 class="text-xl font-bold text-blue-600 mb-2">Appliance Reports</h3>
        <p class="text-gray-600 mb-4">Monitor the status of all your service requests. Ensure all appliances are functioning properly and report issues quickly.</p>
        <a href="/appliance-reports/" class="text-blue-600 hover:underline">Manage your appliance reports →</a>
      </div>
      <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
        <h3 class="text-xl font-bold text-blue-600 mb-2">Minimum Standard Reports</h3>
        <p class="text-gray-600 mb-4">Complete your profile for a better experience. Submit compliance reports to meet property standards and regulations.</p>
        <a href="/standard-reports/" class="text-blue-600 hover:underline">Manage your minimum standard reports →</a>
      </div>
    </section>


  <!-- Progress Section -->
  <section class="bg-white mx-8 my-16 p-6 rounded-lg shadow">
    <h3 class="text-2xl font-bold mb-4 text-gray-800">Complete Your Profile</h3>
    <p class="text-gray-600 mb-4">Profiles that are 100% complete get more attention from traders.</p>

    <div class="w-full bg-blue-100 rounded-full h-3 mb-4">
      <div class="bg-blue-600 h-3 rounded-full" style="width: 75%;"></div>
    </div>

    <div class="space-y-4">
      <div class="flex items-center bg-gray-100 p-4 rounded-lg">
        <span class="text-green-500 text-2xl mr-3">✓</span>
        <span>Add your personal details</span>
      </div>
      <div class="flex items-center bg-gray-100 p-4 rounded-lg">
        <span class="text-green-500 text-2xl mr-3">✓</span>
        <span>Add your agent details</span>
      </div>
      <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg">
        <div class="flex items-center">
          <span class="text-blue-500 text-2xl mr-3">ℹ️</span>
          <span>Complete Condition Report</span>
        </div>
        <a href="" class="text-blue-600 hover:underline">→</a>
      </div>
    <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg">
        <div class="flex items-center">
          <span class="text-blue-500 text-2xl mr-3">ℹ️</span>
          <span>Add Job Requests</span>
        </div>
        <a href="#" class="text-blue-600 hover:underline">→</a>
      </div>

      <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg">
        <div class="flex items-center">
          <span class="text-blue-500 text-2xl mr-3">ℹ️</span>
          <span>Add Appliance reports</span>
        </div>
        <a href="#" class="text-blue-600 hover:underline">→</a>
      </div>

     <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg">
        <div class="flex items-center">
          <span class="text-blue-500 text-2xl mr-3">ℹ️</span>
          <span>Add Minimum Standard Reports</span>
        </div>
        <a href="#" class="text-blue-600 hover:underline">→</a>
      </div>
    </div>

      <!-- Properties Section -->
  <br/>


<!-- Minimum Standard Report  -->


    <div class="mt-6 text-right">
      <a href="#" class="text-blue-600 font-semibold hover:underline">View all tasks</a>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section class="bg-blue-50 py-16 px-8">
    <h3 class="text-3xl font-bold text-center mb-12">What Our Users Say</h3>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="bg-white p-6 rounded-xl shadow text-center hover:shadow-lg transition">
        <p class="text-gray-600 italic mb-4">"FixMyHouse made it so easy to report maintenance issues. The response time is amazing!"</p>
        <h4 class="font-bold text-blue-600">- Jane D.</h4>
      </div>
      <div class="bg-white p-6 rounded-xl shadow text-center hover:shadow-lg transition">
        <p class="text-gray-600 italic mb-4">"I love being able to track all my requests in one place. Very user-friendly."</p>
        <h4 class="font-bold text-blue-600">- Mark S.</h4>
      </div>
      <div class="bg-white p-6 rounded-xl shadow text-center hover:shadow-lg transition">
        <p class="text-gray-600 italic mb-4">"The design is clean and I can complete my profile in minutes. Highly recommended!"</p>
        <h4 class="font-bold text-blue-600">- Sarah W.</h4>
      </div>
    </div>
  </section>

  <!-- Contact Us Section -->
  <section class="px-8 py-16">
    <h3 class="text-3xl font-bold text-center mb-6">Need Help?</h3>
    <p class="text-center text-gray-600 mb-8">Contact our support team and we'll get back to you as soon as possible.</p>
    <div class="flex justify-center">
      <a href="#" class="bg-blue-600 text-white py-3 px-6 rounded-full hover:bg-blue-700 transition">Contact Us</a>
    </div>
  </section>

  <!-- Footer -->
  {% include 'renter/home/footer.html' %}

  <script>
    const menuBtn = document.getElementById('menu-btn');
    const menu = document.getElementById('menu');
    menuBtn.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('border-blue-600', 'text-blue-600', 'active-tab');
          b.classList.add('border-transparent');
        });
        btn.classList.add('border-blue-600', 'text-blue-600', 'active-tab');

        const tab = btn.getAttribute('data-tab');
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.add('hidden'));
        document.getElementById(`tab-${tab}`).classList.remove('hidden');
      });
    });

  function openEditJobModal(id, jobCode, isPriority, status, notes) {
    document.getElementById('editJobModal').classList.remove('hidden');
    document.getElementById('editJobId').value = id;
    document.getElementById('editJobCode').value = jobCode;
    document.getElementById('editPriority').value = isPriority ? 'true' : 'false';
    document.getElementById('editStatus').value = status;
    document.getElementById('editNotes').value = notes || '';

    // Save to sessionStorage to reopen after reload
    sessionStorage.setItem('activeTab', 'traders');
    sessionStorage.setItem('reopenEditJobModal', 'true');
    sessionStorage.setItem('editJobData', JSON.stringify({ id, jobCode, isPriority, status, notes }));

  }

// function handleEditJobSubmit(event) {
//     event.preventDefault();

//     const form = event.target;
//     const formData = new FormData(form);

//     const jobData = {
//       id: formData.get('job_id'),
//       jobCode: document.getElementById('editJobCode').value,
//       isPriority: document.getElementById('editPriority').value === 'true',
//       status: document.getElementById('editStatus').value,
//       notes: document.getElementById('editNotes').value
//     };

//     sessionStorage.setItem('reopenEditJobModal', 'false');
//     sessionStorage.setItem('activeTab', 'traders');

//     // Optional: scroll flag (if needed again)
//     sessionStorage.setItem('scrollToTraders', 'true');

//     // Submit the form normally after saving to sessionStorage
//     form.submit();
//   }

  function openEditConditionModal(roomId) {
    fetch(`/edit-room-condition/${roomId}/json/`)
      .then(response => response.json())
      .then(data => {
        // Set basic fields
        document.getElementById("editRoomConditionId").value = data.id;
        document.getElementById("editRoomName").value = data.room_name;
        document.getElementById("editAgentName").value = data.agent_name;
        document.getElementById("editConditionReportDate").value = data.condition_report_date;

        // Clear previous area fields
        const areaFieldsContainer = document.getElementById("editAreaFields");
        areaFieldsContainer.innerHTML = "";

        // Dynamically add area status fields
        data.areas.forEach(area => {
          const areaDiv = document.createElement("div");
          areaDiv.classList.add("mb-3");

          areaDiv.innerHTML = `
            <input type="hidden" name="area_id_${area.id}" value="${area.id}" />
            <label class="block text-sm font-medium text-gray-700 mb-1">${area.area_name}</label>
            <select name="area_status_${area.id}" class="w-full border p-2 mb-1">
              <option value="Clean" ${area.status === "Clean" ? "selected" : ""}>Clean</option>
              <option value="Undamaged" ${area.status === "Undamaged" ? "selected" : ""}>Undamaged</option>
              <option value="Working" ${area.status === "Working" ? "selected" : ""}>Working</option>
            </select>
          `;

          areaFieldsContainer.appendChild(areaDiv);
        });

        // Show the modal
        document.getElementById("editConditionModal").classList.remove("hidden");
      });
  }
   document.getElementById("editConditionForm").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent default form submission

    const formData = new FormData(this);

      fetch("{% url 'update_room_condition' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
        },
        body: formData,
      })
      .then(response => {
        if (response.ok) {
          // Optional: Close modal
          closeEditConditionModal();

          // Optional: Reload or re-fetch table content dynamically
          location.reload();  // Or you can refresh only the table
        } else {
          alert("Update failed.");
        }
      })
      .catch(error => {
        console.error("Error updating room condition:", error);
      });
    });

    function closeEditConditionModal() {
      document.getElementById("editConditionModal").classList.add("hidden");
    }
      document.getElementById('conditionDateFilter').addEventListener('change', function () {
      const selectedDate = this.value;
      const rows = document.querySelectorAll('tbody tr');

      rows.forEach(row => {
        const cell = row.querySelector('.condition-date-cell');
        const cellDate = cell ? cell.textContent.trim() : '';

        if (!selectedDate || cellDate === selectedDate) {
          row.style.display = '';  // show
        } else {
          row.style.display = 'none';  // hide
        }
      });
    });




    function openEditApplianceModal(reportId) {
    fetch(`/edit-appliance-report/${reportId}/json/`)
      .then(response => response.json())
      .then(data => {
        document.getElementById('editApplianceReportId').value = data.id;
        document.getElementById('editBrand').value = data.brand;
        document.getElementById('editModel').value = data.model_serial;
        document.getElementById('editHeight').value = data.window_height;
        document.getElementById('editLength').value = data.window_length;
        document.getElementById('editWidth').value = data.window_width;
        document.getElementById('editLocation').value = data.location;
        document.getElementById('editComments').value = data.comments;

        document.getElementById('editApplianceModal').classList.remove("hidden");
      });
  }

  function closeEditApplianceModal() {
    document.getElementById('editApplianceModal').classList.add("hidden");
  }

      document.getElementById("editApplianceForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const formData = new FormData(this);

        fetch("/update-appliance-report/", {
          method: "POST",
          headers: {
            "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
          },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Close modal if you want: closeEditApplianceModal();

            const reportId = formData.get("report_id");
            const row = document.querySelector(`tr[data-id="${reportId}"]`);

            if (row) {
              row.querySelector(".brand").textContent = formData.get("brand");
              row.querySelector(".model").textContent = formData.get("model_serial");
              row.querySelector(".location").textContent = formData.get("location");
              row.querySelector(".comments").textContent = formData.get("comments");

              const height = formData.get("window_height");
              const length = formData.get("window_length");
              const width = formData.get("window_width");

              row.querySelector(".dimensions").innerHTML = `
                Height: ${height}<br>
                Length: ${length}<br>
                Width: ${width}
              `;

              // OPTIONAL: Show a toast
              alert("Updated without reloading!");
            }
          }
        });
      });

     document.addEventListener("DOMContentLoaded", function () {
        const hash = window.location.hash.replace("#", "");
        const savedTab = sessionStorage.getItem('activeTab');

        const activeTab = hash || savedTab || 'traders';

        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach(tab => tab.classList.add("hidden"));

        // Show active tab
        const targetTab = document.getElementById(`tab-${activeTab}`);
        if (targetTab) targetTab.classList.remove("hidden");

        // Update active tab button styles
        document.querySelectorAll(".tab-btn").forEach(btn => {
          if (btn.dataset.tab === activeTab) {
            btn.classList.add("border-blue-600", "text-blue-600");
          } else {
            btn.classList.remove("border-blue-600", "text-blue-600");
          }
        });

        // Reopen Edit Job Modal if needed
        if (sessionStorage.getItem('reopenEditJobModal') === 'true') {
          const job = JSON.parse(sessionStorage.getItem('editJobData'));
          if (job) {
            openEditJobModal(job.id, job.jobCode, job.isPriority, job.status, job.notes);
          }

          // Optional: Scroll into view
          // Optional: Scroll into view
          const target = document.getElementById('scrollToTraders');
          if (target) {
            setTimeout(() => {
              target.scrollIntoView({ behavior: 'smooth' });
            }, 300); // delay to allow rendering
          }

          //  Close the Appliance Modal if it’s open
          document.getElementById('editJobModal')?.classList.add('hidden');

          //  Cleanup
          sessionStorage.removeItem('reopenEditJobModal');
          sessionStorage.removeItem('editJobData');
        }
      });



  </script>
<style>
  .modal-backdrop {
    z-index: 1040 !important;
  }
  .modal {
    z-index: 1050 !important;
  }
</style>
</body>

</html>
