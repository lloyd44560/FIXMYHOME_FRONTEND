<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Renter Registration - FixMyHome</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .room-block {
            background-color: #fff;
            border-radius: 6px;
        }

        .condition-block {
            background-color: #f8f9fa;
        }

        .modal-header.bg-gray-100 {
            background-color: #f1f3f5;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

    {% include 'renter/navbar.html' %})


    <main class="flex-grow flex items-center justify-center p-4">
        <div class="w-full max-w-xl bg-white p-6 rounded-lg shadow-md mt-12">

            <button type="button" id="backBtn"
                class="p-2 rounded-md text-blue-600 hover:text-blue-800 hover:bg-blue-100 disabled:opacity-50 disabled:pointer-events-none"
                disabled aria-label="Back">
                <!-- Left arrow icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <h2 class="text-center text-2xl font-bold mb-6">Register as Renter</h2>

            <!-- Stepper -->
            <div class="flex justify-between mb-6">
                <div class="flex-1 flex flex-col items-center">
                    <div id="step1-indicator"
                        class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white font-semibold">
                        1</div>
                    <span class="mt-2 text-sm font-medium text-gray-600">My Details</span>
                </div>
                <div class="flex-1 flex flex-col items-center">
                    <div id="step2-indicator"
                        class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600">
                        2</div>
                    <span class="mt-2 text-sm font-medium text-gray-600">Agent Details</span>
                </div>
                <div class="flex-1 flex flex-col items-center">
                    <div id="step3-indicator"
                        class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-600">
                        3</div>
                    <span class="mt-2 text-sm font-medium text-gray-600">House Details</span>
                </div>
            </div>

            <form id="registrationForm" class="space-y-4" method="POST" style="height: 480px; overflow-y: auto;"
                action="/register_renter/" enctype="multipart/form-data">
                <!-- {% csrf_token %} (Placeholder for Django CSRF token) -->
                <input type="hidden" name="csrfmiddlewaretoken" value="YOUR_CSRF_TOKEN_HERE">

                {% if error %}
                    <div class="text-red-500 text-sm mb-2">{{ error }}</div>
                {% endif %}

                <!-- Step 1 For Personal Details -->
                <div id="step1" class="space-y-4">
                    <div class="mb-4">
                        <label for="name" class="block text-gray-700 font-medium mb-2">Name*</label>
                        <input type="text" name="name" id="name" placeholder="Name"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" value="{{ form_data.name|default_if_none:'' }}" />
                        <p id="nameError" class="text-red-500 text-sm hidden">Name is required.</p>
                    </div>

                    <div class="mb-4">
                        <label for="email" class="block text-gray-700 font-medium mb-2">Email*</label>
                        <input type="email" name="email" id="email" placeholder="Email"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" value="{{ form_data.email|default_if_none:'' }}" >
                        <p id="emailError" class="text-red-500 text-sm hidden">Email is required.</p>
                    </div>

                    <div class="mb-4">
                        <label for="phone" class="block text-gray-700 font-medium mb-2">Phone Number*</label>
                        <input type="tel" name="phone" id="phone" placeholder="Phone Number"
                            oninput="validateFields()" class="w-full border border-gray-300 rounded-md p-2" value="{{ form_data.phone|default_if_none:'' }}"  />
                        <p id="phoneError" class="text-red-500 text-sm hidden">Phone Number is required.</p>
                    </div>

                    <div class="mb-4 relative">
                        <label for="password" class="block text-gray-700 font-medium mb-2">Password*</label>
                        <input id="password" name="password" type="password" placeholder="Password"
                            oninput="validateFields()" class="w-full border border-gray-300 rounded-md p-2 pr-10" />
                        <p id="passwordError" class="text-red-500 text-sm hidden">Passwords do not match.</p>
                        <p id="matchError" class="text-red-500 text-sm hidden">Passwords do not match.</p>

                        <button type="button" id="togglePassword" class="absolute right-2 top-9 text-sm text-gray-600">
                            Show
                        </button>
                    </div>

                    <div class="mb-4 relative">
                        <label for="confirmPassword" class="block text-gray-700 font-medium mb-2">Confirm
                            Password*</label>
                        <input id="confirmPassword" name="confirmPassword" type="password"
                            placeholder="Confirm Password" oninput="validateFields()"
                            class="w-full border border-gray-300 rounded-md p-2 pr-10" />
                        <p id="matchError" class="text-red-500 text-sm hidden">Passwords do not match.</p>

                        <button type="button" id="toggleConfirmPassword"
                            class="absolute right-2 top-9 text-sm text-gray-600">
                            Show
                        </button>
                    </div>
                </div>

                <!-- Step 2 Agent Information -->
                <div id="step2" class="space-y-4 hidden">
                    <div class="mb-4">
                        <label for="company" class="block text-gray-700 font-medium mb-2">My Agent Company Name*</label>
                        <input type="text" name="company" id="company" placeholder="Agent Company Name"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>
                    <p id="companyError" class="text-red-500 text-sm hidden">Company Name is required.</p>

                    <div class="mb-4">
                        <label for="contactPerson" class="block text-gray-700 font-medium mb-2">Contact Person*</label>
                        <input type="text" name="contactPerson" id="contactPerson" placeholder="Contact Person"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>
                    <p id="contactPersonError" class="text-red-500 text-sm hidden">Contact Person is required.</p>

                    <div class="mb-4">
                        <label for="contactPerson" class="block text-gray-700 font-medium mb-2">Contact Email
                            Adress*</label>
                        <input type="email" name="contactPersonEmail" id="contactPersonEmail"
                            placeholder="Contact Person Email Address"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>
                    <p id="contactPersonEmailError" class="text-red-500 text-sm hidden">Contact Person Email is
                        required.</p>

                    <div class="mb-4">
                        <label for="contactPhone" class="block text-gray-700 font-medium mb-2">Contact Phone
                            Number*</label>
                        <input type="tel" name="contactPhone" id="contactPhone" placeholder="Contact Phone Number"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>
                    <p id="contactPhoneError" class="text-red-500 text-sm hidden">Contact Person Phone Number is
                        required.</p>

                    <div class="mb-4">
                        <label for="contactPhone" class="block text-gray-700 font-medium mb-2">Company Address</label>
                    </div>

                    <div class="mb-4">
                        <label for="state" class="block text-gray-700 font-medium mb-2">State*</label>
                        <input type="text" name="state" id="state" placeholder="State"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>
                    <p id="stateError" class="text-red-500 text-sm hidden">State is required.</p>

                    <div class="mb-4">
                        <label for="city" class="block text-gray-700 font-medium mb-2">City*</label>
                        <input type="text" name="city" id="city" placeholder="City"
                            class="w-full border border-gray-300 rounded-md p-2" oninput="validateFields()" />
                    </div>

                    <p id="cityError" class="text-red-500 text-sm hidden"> City is required. </p>

                    <p id="zipError" class="text-red-500 text-sm hidden"> Zip Code is required. </p>

                    <div class="mb-4">
                        <label for="zip" class="block text-gray-700 font-medium mb-2">Address Line 1*</label>
                        <input type="text" name="companyAddressLine1" id="companyAddressLine1"
                            placeholder="Address Line 1" class="w-full border border-gray-300 rounded-md p-2"
                            oninput="validateFields()" />
                    </div>

                    <p id="companyAddressLine1Error" class="text-red-500 text-sm hidden">Company Address Line is
                        required </p>

                    <div class="mb-4">
                        <label for="zip" class="block text-gray-700 font-medium mb-2">Address Line 2 (optional)</label>
                        <input type="text" name="companyAddressLine2" id="companyAddressLine2"
                            placeholder="Address Line 2" class="w-full border border-gray-300 rounded-md p-2" />
                    </div>

                    <div class="mb-4">
                        <label for="zip" class="block text-gray-700 font-medium mb-2">Postal Code</label>
                        <input type="text" name="companyPostalCode" id="companyPostalCode"
                            placeholder="Company Postal Code" class="w-full border border-gray-300 rounded-md p-2" />
                    </div>
                </div>

                <!-- Step 3 Renter Reports -->
                <div id="step3" class="space-y-4 hidden">
                    <div class="mb-4">
                        <select name="uploadOption" id="uploadOption"
                            class="w-full border border-gray-300 rounded-md p-2">
                            <option value="">Select Your Reports</option>
                            <option value="manual">Manually Upload Property Details</option>
                            <option value="report">Upload Property Reports</option>
                        </select>
                    </div>

                    <div id="manualUploadFields" class="space-y-4 hidden">
                        <div class="mb-4">
                            <label for="propertyImage" class="block text-gray-700 font-medium mb-2">Upload Property
                                Photo</label>
                            <img id="imagePreview" src="" alt="Property Image"
                                class="w-full h-auto object-contain rounded mb-4 border border-gray-300" />

                            <input type="file" name="propertyImage" id="propertyImage"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                                accept="image/*" onchange="validateImageFile(this)" />

                            <label for="propertyFile" class="block text-gray-700 font-medium mb-2">Upload Condition
                                Report</label>

                            <input type="file" name="propertyFile" id="propertyFile" accept="file/*"
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                                onchange="validateFileType(this)" />
                        </div>
                        <span id="fileTypeError" class="text-red-500 text-sm hidden">Invalid file type. Only PDF, DOC,
                            DOCX, XLS, XLSX allowed.</span>
                        <div class="mb-4">
                            <label for="propertyName" class="block text-gray-700 font-medium mb-2">Property Name</label>
                            <input type="text" name="propertyName" id="propertyName"
                                placeholder="What is the name of the property?"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>
                        <div class="mb-4">
                            <label for="floorCount" class="block text-gray-700 font-medium mb-2">Floor Count</label>
                            <input type="number" name="floorCount_manual" id="floorCount_manual"
                                placeholder="How many floor is the property?"
                                class="w-full border border-gray-300 rounded-md p-2" min="1"
                                onchange="validateFloorCount(this)" />
                        </div>

                        <div class="mb-4">
                            <label for="leaseStart" class="block text-gray-700 font-medium mb-2">Property Lease
                                Start</label>
                            <input type="date" name="leaseStart_manual" id="leaseStart_manual"
                                placeholder="Date of Property Lease Start?"
                                class="w-full border border-gray-300 rounded-md p-2" min="1"
                                onchange="validateFloorCount(this)" />
                        </div>

                        <div class="mb-4">
                            <label for="leaseEnd" class="block text-gray-700 font-medium mb-2">Property Lease End</label>
                            <input type="date" name="leaseEnd_manual" id="leaseEnd_manual"
                                placeholder="Date of Property Lease End?"
                                class="w-full border border-gray-300 rounded-md p-2" min="1"
                                onchange="validateFloorCount(this)" />
                        </div>

                        <div class="mb-4">
                            <label for="agent_id" class="block text-gray-700 font-medium mb-2">Select Agent</label>
                            <select name="agent_id" id="agent_id" class="w-full border border-gray-300 rounded-md p-2" >
                                <option value="" disabled selected>Select an agent</option>
                                {% for agent in agents %}
                                    <option value="{{ agent.id }}">{{ agent.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="roomCount" class="block text-gray-700 font-medium mb-2">Room Count</label>
                            <input type="number" name="roomCount_manual" id="roomCount_manual"
                                placeholder="How many rooms are in the property?"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>
                        <!-- Surround with blue highlight border -->
                        <div class="mb-6">
                            <label for="roomType" class="block text-gray-700 font-semibold mb-2">Rooms</label>
                            <!-- Input and Add Button -->
                            <div class="flex gap-2 mb-4">
                                <input type="text" id="roomType" placeholder="Enter Room Type (e.g., Bedroom)"
                                    class="flex-1 border border-gray-300 rounded-md p-2" />
                                <button type="button" id="addRoomBtn"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                                    Add Room
                                </button>
                            </div>

                            <!-- Room List -->
                            <ul id="roomList" class="space-y-3">

                                <!-- Dynamic items will be added here -->
                            </ul>
                            <input  name="roomListData" id="roomListData">
                        </div>

                        <div class="mb-4">
                            <label for="houseState" class="block text-gray-700 font-medium mb-2">State</label>
                            <input type="text" name="houseState_manual" id="houseState_manual" placeholder="State"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>

                        <div class="mb-4">
                            <label for="houseCity" class="block text-gray-700 font-medium mb-2">City</label>
                            <input type="text" name="houseCity_manual" id="houseCity_manual" placeholder="City"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>

                        <div class="mb-4">
                            <label for="address1" class="block text-gray-700 font-medium mb-2">Address Line 1</label>
                            <input type="text" name="address1" id="address1" placeholder="Address Line 1"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>

                        <div class="mb-4">
                            <label for="address2" class="block text-gray-700 font-medium mb-2">Address Line 2(Optional)</label>
                            <input type="text" name="address2" id="address2" placeholder="Address Line 2"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>

                        <div class="mb-4">
                            <label for="postalcode" class="block text-gray-700 font-medium mb-2">Postal Code</label>
                            <input type="text" name="postalcode" id="postalcode" placeholder="Postal Code"
                                class="w-full border border-gray-300 rounded-md p-2" />
                        </div>
                    </div>

                    <div id="reportUploadFields" class="space-y-4 hidden">
                        <p class="font-semibold mb-2 h5">Select Your Reports</p>

                        <div class="d-flex flex-column gap-3 w-100 px-3" style="max-width: 500px;">
                            <!-- Condition Report -->
                            <button type="button" class="w-full btn btn-primary py-2" data-bs-toggle="modal"
                                data-bs-target="#conditionModal">
                                Condition Report
                            </button>

                            <!-- Appliance Report -->
                            <button type="button" class="w-full btn btn-primary py-2" data-bs-toggle="modal"
                                data-bs-target="#applianceModal">
                                Appliance Report
                            </button>

                            <!-- Minimum Standard Reports -->
                            <button type="button" class="w-full btn btn-primary py-2" data-bs-toggle="modal"
                                data-bs-target="#standardModal">
                                Minimum Standard Reports
                            </button>
                        </div>

                        <!-- Room Condition Modal -->
                        <div class="modal fade" id="conditionModal" tabindex="-1"
                            aria-labelledby="conditionModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header bg-gray-100">
                                        <h5 class="modal-title" id="conditionModalLabel">Room Condition Report</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>

                                    <div class="modal-body">
                                        <!-- Property Info -->
                                        <div class="mb-3">
                                            <label class="form-label">Property Name</label>
                                            <input type="text" class="form-control" name="property_name" >
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Property Address</label>
                                            <input type="text" class="form-control" name="property_address" >
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Property Photo</label>
                                            <!-- Hidden file input -->
                                            <input type="file" id="propertyPhotoUpload" class="form-control d-none" name="property_photo_condition" accept="image/*">

                                            <!-- Visible button to trigger file selection -->
                                            <button type="button" class="btn btn-outline-primary mb-2" onclick="document.getElementById('propertyPhotoUpload').click()">
                                                Select Image
                                            </button>

                                            <!-- Image preview container -->
                                            <div id="imagePreviewContainer" class="mt-2" style="display: none;">
                                                <img id="imagePreview" src="#" alt="Property Photo Preview" class="img-thumbnail" style="max-width: 300px; max-height: 200px;">
                                                <button type="button" class="btn btn-sm btn-danger mt-2" onclick="removeImage()">
                                                    Remove Image
                                                </button>
                                            </div>

                                            <!-- Hidden field to store the filename -->
                                            <input type="text" id="propertyPhotoFilename" class="form-control mt-2" name="property_photo_condition" readonly>
                                        </div>

                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Lease Start</label>
                                                <input type="date" name="lease_start" class="form-control" >
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Lease End</label>
                                                <input type="date" name="lease_end" class="form-control" >
                                            </div>
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label">Select Agent</label>
                                            <select name="agent_id_condition" id="agent_id_condition" class="form-select" required>
                                                <option value="" disabled selected>Select an agent</option>
                                                {% for agent in agents %}
                                                    <option value="{{ agent.id }}">{{ agent.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!-- Room Blocks -->
                                        <div id="roomsContainer"></div>

                                        <div class="d-grid">
                                            <button type="button" class="btn btn-outline-primary mt-3"
                                                onclick="addRoom()">+ Add Room</button>
                                        </div>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" id="saveConditionBtn" class="btn btn-primary">Save
                                            Only</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Saved Alert Message -->
                        <div class="toast-container position-fixed bottom-0 end-0 p-3">
                            <div id="saveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                                <div class="toast-header">
                                    <strong class="me-auto text-success">Saved</strong>
                                    <small>Just now</small>
                                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                                </div>
                                <div class="toast-body">
                                    Inspection data saved successfully.
                                </div>
                            </div>
                        </div>

                        <!-- Appliance Report Modal -->
                        <div class="modal fade" id="applianceModal" tabindex="-1"
                            aria-labelledby="applianceModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content p-4">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Appliance Report</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>

                                    <div class="modal-body">
                                        <div id="applianceFieldsContainer" class="space-y-3"></div>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" id="saveApplianceReportBtn" class="btn btn-primary">Save
                                            Appliance Report</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Minimum Standard Report-->
                        <div class="modal fade" id="standardModal" tabindex="-1" aria-labelledby="standardModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content p-4">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="standardModalLabel">Minimum Standard Report</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body grid grid-cols-2 gap-4">

                                        <input type="text" name="tenant_name" class="form-control"
                                            placeholder="Tenant Name">
                                        <input type="text" name="audit_no" class="form-control" placeholder="Audit No">
                                        <input type="text" name="auditor" class="form-control" placeholder="Auditor">
                                        <input type="text" name="inspection_address" class="form-control"
                                            placeholder="Inspection Address">
                                        <input type="text" name="managing_agent" class="form-control"
                                            placeholder="Managing Agent">
                                        <input type="date" name="audit_date" class="form-control"
                                            placeholder="Audit Date">
                                        <input type="text" name="room" class="form-control" placeholder="Room">
                                        <input type="text" name="company" class="form-control" placeholder="Company">
                                        <input type="text" name="name" class="form-control" placeholder="Name">
                                        <input type="date" name="audit_expiry" class="form-control"
                                            placeholder="Audit Expiry">
                                        <textarea name="comments" class="form-control" placeholder="Comments"></textarea>
                                        <input type="file" name="report_file" class="form-control">

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- All modals and forms related to the Condition Reports -->
                        <!-- Add Category Modal -->
                        <div id="addCategoryModal"
                            class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
                            <div class="bg-white w-full max-w-sm p-6 rounded-md shadow-md">
                                <h2 class="text-lg font-bold mb-4 text-center">Add New Room Category</h2>
                                <input id="newCategoryInput" type="text" placeholder="Enter new category"
                                    class="w-full border border-gray-300 rounded px-3 py-2 mb-4" />
                                <div class="flex justify-end gap-2">
                                    <button type="button" onclick="closeAddCategoryModal()"
                                        class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
                                    <button type="button" onclick="confirmAddCategory()"
                                        class="px-4 py-2 bg-blue-600 text-white rounded">Add</button>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Category Name Modal -->
                        <div id="editCategoryModal"
                            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                            <div class="bg-white p-6 rounded shadow-md w-full max-w-md">
                                <h2 class="text-lg font-bold mb-4">Edit Room Details</h2>

                                <label class="block mb-2 font-semibold">Room Name</label>
                                <input id="editCategoryInput" type="text" class="w-full border p-2 mb-4" />

                                <label class="block mb-2 font-semibold">Room Dimensions (ft)</label>
                                <div class="flex gap-2 mb-4">
                                    <input id="roomWidth" type="number" placeholder="Width"
                                        class="w-1/2 border p-2" />
                                    <input id="roomLength" type="number" placeholder="Length"
                                        class="w-1/2 border p-2" />
                                </div>

                                <label class="block mb-2 font-semibold">Room Category</label>
                                <select id="modalRoomCategory" class="w-full border p-2 mb-4"></select>
                                <div class="mb-4">
                                    <label class="block mb-2 font-semibold">Room Areas</label>
                                    <div id="editRoomAreaTableWrapper">
                                        <!-- Table will be injected dynamically -->
                                    </div>
                                </div>

                                <div class="flex justify-end gap-2">
                                    <button type="button" onclick="closeEditModal()"
                                        class="text-gray-500">Cancel</button>
                                    <button type="button" onclick="saveEditedCategoryFromModal()"
                                        class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between">
                    <button type="button" id="nextBtn" class="w-full px-4 py-2 bg-blue-600 text-white rounded">Continue</button>
                    <button type="submit" id="submitBtn"
                        class="w-full px-4 py-2 bg-green-600 text-white rounded hidden">Submit</button>
                </div>

                <!-- Login Link -->
                <p class="text-center text-sm mt-4">
                    Already have an account?
                    <a href="/login_renter/" class="text-blue-600 font-semibold hover:underline">Login Here</a>
                </p>
            </form>
        </div>
    </main>
    <br>
     {% include 'renter/footer.html' %}
    <!-- Footer (Placeholder - original content was {% include 'renter/home/footer.html' %}) -->


    <script>
        // All JavaScript consolidated here

        // Tracking the current steps
        const steps = [document.getElementById('step1'), document.getElementById('step2'), document.getElementById('step3')];
        const stepIndicators = [
            document.getElementById('step1-indicator'),
            document.getElementById('step2-indicator'),
            document.getElementById('step3-indicator'),
        ];
        const backBtn = document.getElementById('backBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const uploadOption = document.getElementById('uploadOption');
        const manualUploadFields = document.getElementById('manualUploadFields');
        const reportUploadFields = document.getElementById('reportUploadFields'); // Added this line

        let currentStep = 0;

        function updateStep() {
            steps.forEach((step, index) => {
                step.classList.toggle('hidden', index !== currentStep);
                stepIndicators[index].classList.toggle('bg-blue-600', index === currentStep);
                stepIndicators[index].classList.toggle('text-white', index === currentStep);
                stepIndicators[index].classList.toggle('bg-gray-300', index !== currentStep);
                stepIndicators[index].classList.toggle('text-gray-600', index !== currentStep);
            });

            backBtn.disabled = currentStep === 0;

            if (currentStep === steps.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }

            // Show manual/report upload fields only if on step 3 and option selected
            if (currentStep === 2) {
                toggleFields(); // Call toggleFields to ensure correct visibility
            } else {
                manualUploadFields.classList.add('hidden');
                reportUploadFields.classList.add('hidden');
            }
        }

        backBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateStep();
            }
        });

        nextBtn.addEventListener('click', () => {
            // Validate current step fields before proceeding
            if (currentStep === 0) {
                validateFields();
                if (!areStep1FieldsValid()) {
                    return;
                }
            } else if (currentStep === 1) {
                validateFields();
                if (!areStep2FieldsValid()) {
                    return;
                }
            }

            if (currentStep < steps.length - 1) {
                currentStep++;
                updateStep();
            }
        });

        uploadOption.addEventListener('change', () => {
            if (currentStep === 2) {
                toggleFields();
            }
        });

        function toggleFields() {
            const selected = uploadOption.value;
            if (selected === "manual") {
                manualUploadFields.classList.remove("hidden");
                reportUploadFields.classList.add("hidden");
                reportUploadFields.style.display = "none"; // Add this line
            } else if (selected === "report") {
                manualUploadFields.classList.add("hidden");
                reportUploadFields.classList.remove("hidden");
                reportUploadFields.style.display = ""; // Reset display
            } else {
                manualUploadFields.classList.add("hidden");
                reportUploadFields.classList.add("hidden");
                reportUploadFields.style.display = "none"; // Add this line
            }
        }
        // Password toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        togglePassword.addEventListener('click', () => {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                togglePassword.textContent = 'Hide';
            } else {
                passwordInput.type = 'password';
                togglePassword.textContent = 'Show';
            }
        });

        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        toggleConfirmPassword.addEventListener('click', () => {
            if (confirmPasswordInput.type === 'password') {
                confirmPasswordInput.type = 'text';
                toggleConfirmPassword.textContent = 'Hide';
            } else {
                confirmPasswordInput.type = 'password';
                toggleConfirmPassword.textContent = 'Show';
            }
        });



        function areStep1FieldsValid() {
            const requiredFields = [
                "name", "email", "phone", "password", "confirmPassword"
            ];

            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    const errorElement = document.getElementById(`${fieldId}Error`);
                    if (errorElement) {
                        errorElement.classList.remove("hidden");
                    }
                    field.classList.add("border-red-500");
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    // Show error message
                    Swal.fire({
                        icon: 'error',
                        title: 'Missing Information',
                        text: 'Please fill out all required fields before continuing.',
                    });

                    return false;
                }
            }

            // Check password match
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            if (password !== confirmPassword) {
                document.getElementById("matchError").classList.remove("hidden");
                document.getElementById("confirmPassword").classList.add("border-red-500");

                Swal.fire({
                    icon: 'error',
                    title: 'Password Mismatch',
                    text: 'Passwords do not match. Please try again.',
                });

                return false;
            }

            return true;
        }




        function areStep2FieldsValid() {
            const requiredFields = [
                "company", "contactPerson", "contactPersonEmail",
                "contactPhone", "state", "city", "companyAddressLine1"
            ];
            let isValid = true;

            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorElement = document.getElementById(`${fieldId}Error`);

                if (!field.value.trim()) {
                    field.classList.add("border-red-500");
                    errorElement.classList.remove("hidden");
                    isValid = false;
                } else {
                    field.classList.remove("border-red-500");
                    errorElement.classList.add("hidden");
                }
            });

            if (!isValid) {
                Swal.fire({
                    icon: 'error',
                    title: 'Missing Information',
                    text: 'Please fill out all required fields in Agent Details before continuing.',
                });
            }

            return isValid;
        }

        // Form validation
        function validateFields() {
            const fields = [
                { id: "name", error: "nameError" },
                { id: "email", error: "emailError" },
                { id: "phone", error: "phoneError" },
                { id: "password", error: "passwordError" },
                { id: "confirmPassword", error: "confirmPasswordError" },
                { id: "company", error: "companyError" },
                { id: "contactPerson", error: "contactPersonError" },
                { id: "contactPersonEmail", error: "contactPersonEmailError" },
                { id: "contactPhone", error: "contactPhoneError" },
                { id: "state", error: "stateError" },
                { id: "city", error: "cityError" },
                { id: "companyAddressLine1", error: "companyAddressLine1Error" },
            ];

            fields.forEach(({ id, error }) => {
                const input = document.getElementById(id);
                const errorMsg = document.getElementById(error);

                if (input && errorMsg) {
                    if (input.value.trim() === "") {
                        input.classList.add("border-red-500");
                        errorMsg.classList.remove("hidden");
                    } else {
                        input.classList.remove("border-red-500");
                        errorMsg.classList.add("hidden");
                    }
                }
            });

            // Password strength validation
            const password = document.getElementById("password").value.trim();
            const passwordError = document.getElementById("passwordError");
            const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;

            if (!strongPasswordRegex.test(password)) {
                passwordError.textContent = "Password must be at least 8 characters long, include uppercase, lowercase, number, and special character.";
                passwordError.classList.remove("hidden");
                document.getElementById("password").classList.add("border-red-500");
            } else {
                passwordError.classList.add("hidden");
                document.getElementById("password").classList.remove("border-red-500");
            }

            // Password match validation
            const confirmPassword = document.getElementById("confirmPassword").value.trim();
            const matchError = document.getElementById("matchError");

            if (password && confirmPassword && password !== confirmPassword) {
                matchError.classList.remove("hidden");
                document.getElementById("confirmPassword").classList.add("border-red-500");
            } else {
                matchError.classList.add("hidden");
                document.getElementById("confirmPassword").classList.remove("border-red-500");
            }
        }

        document.getElementById('propertyImage').addEventListener('change', function (event) {
            const file = event.target.files[0];
            const preview = document.getElementById('imagePreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = '';
            }
        });

        // Form submission
        document.getElementById("registrationForm").addEventListener("submit", function (e) {
            e.preventDefault(); // Prevent default form submission

            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;

            // Empty field check for step 1
            if (currentStep === 0 && (!name || !email || !password || !confirmPassword)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Missing Fields',
                    text: 'Please fill out all required fields in "My Details".',
                });
                return;
            }

            if (password !== confirmPassword) {
                Swal.fire({
                    icon: 'error',
                    title: 'Password Mismatch',
                    text: 'Passwords do not match. Please try again.',
                });
                return;
            }

            // For demonstration, if all checks pass, show success and then submit
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Registration successful!',
            }).then(() => {
                e.target.submit(); // Submit the form after success message
            });
        });

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const input = document.getElementById("propertyImage");
            const preview = document.getElementById("imagePreview");

            if (input && preview) {
                input.addEventListener("change", function (event) {
                    const file = event.target.files[0];

                    if (file && file.type.startsWith("image/")) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            preview.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.src = "";
                    }
                });
            }
            updateStep(); // Initialize step visibility on page load
            toggleFields(); // Initialize manual/report fields visibility
        });

        function validateImageFile(input) {
            const file = input.files[0];
            if (file && !file.type.startsWith('image/')) {
                alert("Please upload a valid image file only (e.g. JPG, PNG).");
                input.value = ""; // clear the invalid file
            }
        }

        function validateFileType(input) {
            const allowedExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx'];
            const errorMsg = document.getElementById('fileTypeError');

            if (!input.files.length) return;

            const fileName = input.files[0].name;
            const fileExtension = fileName.split('.').pop().toLowerCase();

            if (!allowedExtensions.includes(fileExtension)) {
                input.value = ''; // Clear the selected file
                errorMsg.classList.remove('hidden');
            } else {
                errorMsg.classList.add('hidden');
            }
        }

        // Condition Report Script
        let collectedRoomData = []; // Global variable for room data

        function getNextRoomNumber() {
            const roomsContainer = document.getElementById("roomsContainer");
            const used = Array.from(roomsContainer.querySelectorAll(".room-block")).map(
                (block) => parseInt(block.dataset.roomIndex)
            );
            let i = 1;
            while (used.includes(i)) i++;
            return i;
        }

        window.addRoom = function () {
            const roomsContainer = document.getElementById("roomsContainer");
            const roomIndex = getNextRoomNumber();

            const roomHtml = `
                <div class="card mb-4 shadow-sm room-block border-start border-4 border-primary" data-room-index="${roomIndex}" id="room_block_${roomIndex}">
                    <div class="card-header d-flex justify-content-between align-items-center bg-white">
                        <h5 class="mb-0">Room ${roomIndex}</h5>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeRoom(${roomIndex})">
                            <i class="bi bi-trash"></i> Remove Room
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Room Name</label>
                                <input type="text" class="form-control room-name-input" name="room_name_${roomIndex}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Room Photo</label>
                                <input type="file" class="form-control" name="room_photo_${roomIndex}" accept="image/*">
                            </div>
                        </div>
                        <div id="areaConditions_${roomIndex}"></div>
                        <div class="d-grid">
                            <button type="button" class="btn btn-outline-secondary" onclick="addAreaCondition(${roomIndex})">
                                + Add Area Condition
                            </button>
                        </div>
                    </div>
                </div>
            `;
            roomsContainer.insertAdjacentHTML("beforeend", roomHtml);
        };

        window.addAreaCondition = function (roomIdx) {
            const container = document.getElementById(`areaConditions_${roomIdx}`);
            const condCount = container.querySelectorAll(".condition-block").length;

            const conditionHtml = `
                <div class="card mb-3 condition-block" id="condition_${roomIdx}_${condCount}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">Condition ${condCount + 1}</h6>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeAreaCondition(${roomIdx}, ${condCount})">
                                <i class="bi bi-x-circle"></i> Remove
                            </button>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Area Name</label>
                                <input type="text" class="form-control" name="area_name_${roomIdx}[]" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Condition</label>
                                <select class="form-select" name="condition_${roomIdx}[]" required>
                                    <option value="Clean">Clean</option>
                                    <option value="Undamaged">Undamaged</option>
                                    <option value="Working">Working</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Remarks</label>
                                <input type="text" class="form-control" name="remarks_${roomIdx}[]">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Upload Photo (Optional)</label>
                                <input type="file" class="form-control" name="area_photo_${roomIdx}[]" accept="image/*">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML("beforeend", conditionHtml);
        };

        window.removeRoom = function (roomIdx) {
            const roomBlock = document.getElementById(`room_block_${roomIdx}`);
            if (roomBlock) roomBlock.remove();
        };

        window.removeAreaCondition = function (roomIdx, condIdx) {
            const conditionBlock = document.getElementById(`condition_${roomIdx}_${condIdx}`);
            if (conditionBlock) conditionBlock.remove();
        };

        // Save button for Condition Report
        const saveConditionBtn = document.getElementById("saveConditionBtn");
        saveConditionBtn?.addEventListener("click", function () {
            collectedRoomData = [];
            const roomBlocks = document.querySelectorAll(".room-block");
            roomBlocks.forEach((block) => {
                const roomName = block.querySelector(".room-name-input")?.value || "";
                if (roomName.trim()) {
                    collectedRoomData.push({ roomName });
                }
            });

            const toast = new bootstrap.Toast(document.getElementById('saveToast'));
            toast.show();

            const conditionModal = bootstrap.Modal.getInstance(document.getElementById("conditionModal"));
            conditionModal?.hide();
        });

        // Appliance Report Script
        let savedApplianceData = {}; // key: roomName, value: data

        document.addEventListener('DOMContentLoaded', function () {
            const applianceModal = document.getElementById('applianceModal');
            const container = document.getElementById('applianceFieldsContainer');
            const saveButton = document.getElementById('saveApplianceReportBtn');

            // Populate modal fields
            applianceModal.addEventListener('show.bs.modal', function () {
                container.innerHTML = ''; // Clear previous

                // Use the collectedRoomData from the Condition Report
                if (collectedRoomData.length === 0) {
                    // Fallback if no rooms were added in Condition Report
                    collectedRoomData = [{ roomName: 'Living Room' }, { roomName: 'Bedroom' }];
                }

                collectedRoomData.forEach((room, index) => {
                    const data = savedApplianceData[room.roomName] || {};

                    const group = document.createElement('div');
                    group.className = 'border p-3 rounded bg-light';

                    group.innerHTML = `
                        <div><strong>Room:</strong> ${room.roomName}</div>
                        <input type="hidden" name="appliance_room_name[]" value="${room.roomName}"/>

                        <div class="mb-2 mt-2">
                            <label>Appliance Name</label>
                            <input type="text" name="appliance_name[]" class="form-control" value="${data.name || ''}" required>
                        </div>

                        <div class="mb-2">
                            <label>Condition</label>
                            <input type="text" name="appliance_condition[]" class="form-control" value="${data.condition || ''}" required>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <label>Window Height</label>
                                <input type="text" name="window_height[]" class="form-control" value="${data.height || ''}" required>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label>Window Length</label>
                                <input type="text" name="window_length[]" class="form-control" value="${data.length || ''}" required>
                            </div>
                            <div class="col-md-4 mb-2">
                                <label>Window Width</label>
                                <input type="text" name="window_width[]" class="form-control" value="${data.width || ''}" required>
                            </div>
                        </div>

                        <div class="mb-2">
                            <label>Appliance Photo</label>
                            <input type="file" name="appliance_photo[]" accept="image/*" class="form-control">
                        </div>

                        <div class="mb-2">
                            <label>Comments</label>
                            <textarea name="comments[]" class="form-control" rows="2">${data.comments || ''}</textarea>
                        </div>
                    `;

                    group.dataset.room = room.roomName;
                    container.appendChild(group);
                });
            });

            // Save button click for Appliance Report
            saveButton.addEventListener('click', function () {
                const groups = container.querySelectorAll('[data-room]');

                groups.forEach(group => {
                    const room = group.dataset.room;
                    const inputs = group.querySelectorAll('input, textarea');

                    let applianceInfo = {};

                    inputs.forEach(input => {
                        const name = input.name;

                        if (name.includes('appliance_name')) {
                            applianceInfo.name = input.value;
                        }
                        if (name.includes('appliance_condition')) {
                            applianceInfo.condition = input.value;
                        }
                        if (name.includes('window_height')) {
                            applianceInfo.height = input.value;
                        }
                        if (name.includes('window_length')) {
                            applianceInfo.length = input.value;
                        }
                        if (name.includes('window_width')) {
                            applianceInfo.width = input.value;
                        }
                        if (name.includes('comments')) {
                            applianceInfo.comments = input.value;
                        }
                    });

                    savedApplianceData[room] = applianceInfo;
                });

                const modalInstance = bootstrap.Modal.getInstance(applianceModal);
                modalInstance.hide();
            });
        });

        // Placeholder functions for modals that were not fully implemented in the original script
        window.closeAddCategoryModal = function () {
            document.getElementById('addCategoryModal').classList.add('hidden');
        };
        window.confirmAddCategory = function () {
            // Logic to add category
            document.getElementById('addCategoryModal').classList.add('hidden');
        };
        window.closeEditModal = function () {
            document.getElementById('editCategoryModal').classList.add('hidden');
        };
        window.saveEditedCategoryFromModal = function () {
            // Logic to save edited category
            document.getElementById('editCategoryModal').classList.add('hidden');
        };
        window.validateFloorCount = function (input) {
            // Placeholder for floor count validation
            if (input.value < 1) {
                input.value = 1;
            }
        };
    </script>


    <script>
        let roomList = [];

        document.getElementById('addRoomBtn').addEventListener('click', function () {
            const input = document.getElementById('roomType');
            const roomName = input.value.trim();

            if (roomName !== '') {
                roomList.push(roomName);
                updateRoomListDisplay();
                input.value = '';
            }
        });

        function updateRoomListDisplay() {
            const listElement = document.getElementById('roomList');
            const hiddenInput = document.getElementById('roomListData');

            listElement.innerHTML = '';

            roomList.forEach((room, index) => {
                const li = document.createElement('li');
                li.className = "flex items-center justify-between border px-4 py-2 rounded-md bg-gray-100";

                li.innerHTML = `
                    <span>${room}</span>
                    <button type="button" class="text-red-500" onclick="removeRoom(${index})">Remove</button>
                `;

                listElement.appendChild(li);
            });

            // Update hidden field for backend
            hiddenInput.value = JSON.stringify(roomList);
             console.log("Sending roomListData:", document.getElementById('roomListData').value);
        }

        function removeRoom(index) {
            roomList.splice(index, 1);
            updateRoomListDisplay();
        }
    </script>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const uploadOption = document.getElementById('uploadOption');
        const agentSelect = document.getElementById('agent_id_condition');
        uploadOption.addEventListener('change', function() {
            if (uploadOption.value === 'report') {
                agentSelect.setAttribute('required', 'required'); // Make agent select required
            } else {
                agentSelect.removeAttribute('required'); // Remove required attribute
            }
        });
    });
    </script>

    <script>
    // Function to handle image preview
    document.getElementById('propertyPhotoUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreviewContainer').style.display = 'block';
                document.getElementById('propertyPhotoFilename').value = file.name;
            }
            reader.readAsDataURL(file);
        }
    });
    // Function to remove selected image
    function removeImage() {
        document.getElementById('propertyPhotoUpload').value = '';
        document.getElementById('imagePreviewContainer').style.display = 'none';
        document.getElementById('propertyPhotoFilename').value = '';
    }
    </script>

</body>

</html>
