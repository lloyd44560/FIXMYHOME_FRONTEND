{% extends "baseTrader.html" %}
{% load widget_tweaks %}

{% block content %}
<!-- Top Navigation -->
{% include 'components/home/navigatorBase.html' %}

<div class="max-w-3xl mx-auto p-8 sm:p-10 bg-white shadow-lg rounded-2xl mt-10 mb-20 border border-gray-200">
  <!-- Header -->
  <div class="text-center mb-8">
    <h2 class="text-3xl font-bold text-[#293272]">Create Quotation</h2>
    <p class="text-gray-500 mt-2 text-sm">
      Please provide complete details for your quotation. The agent will review your submission.
    </p>
  </div>

  <!-- Form -->
  <form method="post" class="space-y-8">
    {% csrf_token %}

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <!-- Job -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Job</label>
        <select 
          name="jobs" 
          id="id_jobs" 
          class="w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition rounded-md"
          required
        >
          <option value="" selected disabled>Select a job</option>
          {% for job in jobs_filtered %}
            <option value="{{ job.id }}">
              {{ job.job_code }} - {% if job.priority %}High priority{% else %}Less priority{% endif %}
            </option>
          {% empty %}
            <option value="" disabled>No open quoted jobs available</option>
          {% endfor %}
        </select>
      </div>

      <!-- Team Member -->
      {% if is_director %}
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Team Member</label>
          <select 
            name="jobs" 
            id="id_jobs" 
            class="w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition rounded-md"
            required
          >
            <option value="" selected disabled>Select a Team</option>
            {% for team in team_member_filtered %}
              <option value="{{ team.id }}">
                {{ team.teamName }} - {{ team.position}}
              </option>
            {% empty %}
              <option value="" disabled>No team members available.</option>
            {% endfor %}
          </select>
        </div>
      {% else %}
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Team Member</label>
          <input type="text" class="w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" value="{{ memberName }}" disabled>
        </div>
      {% endif %}

      <!-- Labour per Hour -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Labour per Hour</label>
        {{ form.labour_per_hour|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Callout Rate -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Callout Rate</label>
        {{ form.callout_rate|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Parts Qty -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Parts Quantity</label>
        {{ form.parts_qty|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Parts Unit Price -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Parts Unit Price</label>
        {{ form.parts_unit_price|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Hours -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Hours</label>
        {{ form.hours|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Appliance Model -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Appliance Model</label>
        {{ form.appliance_model|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>

      <!-- Appliance Model Price -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Appliance Model Price</label>
        {{ form.appliance_model_price|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
      </div>
    </div>

    <!-- Schedule Dates -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
        {{ form.start_date|add_class:"w-full border border-gray-300 px-4 py-2 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
        {{ form.end_date|add_class:"w-full border border-gray-300 px-4 py-2 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
    </div>

    <!-- Notes -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
      {{ form.notes|add_class:"w-full border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm transition" }}
    </div>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row justify-end gap-4 pt-6">
      <a href="javascript:history.back()" 
         class="px-6 py-3 text-gray-700 border border-gray-300 font-medium hover:bg-gray-100 transition text-center">
        Cancel
      </a>
      <button type="submit" 
              class="bg-[#293272] hover:bg-[#162060] text-white px-6 py-3 font-semibold shadow-md transition">
        Submit Quotation
      </button>
    </div>
  </form>
</div>

<!-- Flash Messages -->
{% if messages %}
  <div class="fixed top-6 right-6 z-50 space-y-3">
    {% for message in messages %}
      <div
        x-data="{ show: true }"
        x-init="setTimeout(() => show = false, 4000)"
        x-show="show"
        class="px-5 py-3 shadow-lg text-sm font-medium transition
              {% if 'error' in message.tags %}
                bg-red-500 text-white
              {% elif 'success' in message.tags %}
                bg-green-500 text-white
              {% else %}
                bg-gray-700 text-white
              {% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

{% include 'components/footerTrader.html' %}
{% endblock %}

{% block scripts %}
  <!-- JS Scripts Here! -->
{% endblock %}