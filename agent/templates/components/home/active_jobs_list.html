{% extends "baseAgent.html" %}

{% block content %}
<!-- Top Navigation -->
{% include 'components/home/navigatorBaseAgent.html' %}

<main class="max-w-5xl mx-auto p-4 sm:p-6 mb-[8rem] flex-1 w-full">
  <h2 class="text-2xl sm:text-3xl font-bold text-[#293272] mb-6 text-center tracking-tight">Active Maintenance Report</h2>

  <!-- Filter Form -->
  <form method="GET" class="mb-6">
    <div class="flex flex-col md:flex-row gap-4">
      <!-- Status Filter -->
      <div>
        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
        <select name="status" id="status" class="mt-1 p-2 border rounded-md w-full md:w-40" onchange="this.form.submit()">
          <option value="">All Statuses</option>
          {% for key, label in status_options.items %}
            <option value="{{ key }}" {% if key == filter_status %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <!-- Category Filter -->
      <div>
        <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
        <select name="category" id="category" class="mt-1 p-2 border rounded-md w-full md:w-40" onchange="this.form.submit()">
          <option value="">All Category</option>
          {% for key, label in category_options.items %}
            <option value="{{ key }}" {% if key == filter_category %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <!-- Priority Filter -->
      <div>
        <label for="priority" class="block text-sm font-medium text-gray-700">Priority</label>
        <select name="priority" id="priority" class="mt-1 p-2 border rounded-md w-full md:w-40" onchange="this.form.submit()">
          <option value="">All Priority</option>
          <option value="true" {% if filter_priority == 'true' %}selected{% endif %}>Urgent</option>
          <option value="false" {% if filter_priority == 'false' %}selected{% endif %}>Non-urgent</option>
        </select>
      </div>
      <!-- Scheduled At Filter -->
      <div>
        <label for="priority" class="block text-sm font-medium text-gray-700">Scheduled At</label>
        <input type="date" name="scheduled_at" id="scheduled_at" class="mt-1 p-2 border rounded-md w-full md:w-40" value="{{ filter_scheduled_at }}" onchange="this.form.submit()">
      </div>
      <!-- Address Filter -->
      <div>
        <label for="trader" class="block text-sm font-medium text-gray-700">Trader</label>
        <input type="text" name="trader" id="trader" value="{{ filter_trader }}"
          class="mt-1 p-2 border rounded-md w-full md:w-40"
          placeholder="Enter Trader"
          onchange="this.form.submit()">
      </div>
    </div>
  </form>

  <div class="space-y-4">
  <!-- Table layout for larger screens -->
  <div class="hidden sm:block overflow-x-auto rounded-xl shadow">
    <table class="min-w-full bg-white border border-gray-200 rounded-xl overflow-hidden">
      <thead class="bg-blue-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Job Code</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Renter</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Trader</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Status</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Priority</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Scheduled</th>
        </tr>
      </thead>
      <tbody>
        {% for job in jobs %}
        <tr class="border-t border-gray-100 hover:bg-blue-50 transition">
          <td class="px-4 py-3 whitespace-nowrap">{{ job.job_code }}</td>
          <td class="px-4 py-3 whitespace-nowrap">{{ job.renter }}</td>
          <td class="px-4 py-3 whitespace-nowrap">{{ job.trader }}</td>
          <td class="px-4 py-3 whitespace-nowrap">{{ job.get_status_display }}</td>
          <td class="px-4 py-3 whitespace-nowrap">
            {% if job.priority %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">High</span>
            {% else %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-800">Normal</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 whitespace-nowrap">{{ job.scheduled_at|date:"Y-m-d H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center py-4">No active jobs found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  {% if page_obj.has_other_pages %}
    <div class="pagination flex justify-center items-center mt-6 space-x-2">
      <!-- Previous Button -->
      {% if page_obj.has_previous %}
      <a href="{% url 'active_jobs_list' %}?page={{ page_obj.previous_page_number }}{% if filter_status %}&status={{ filter_status }}{% endif %}{% if filter_category %}&category={{ filter_category }}{% endif %}{% if filter_priority %}&priority={{ filter_priority }}{% endif %}{% if filter_trader %}&trader={{ filter_trader|urlencode }}{% endif %}{% if filter_scheduled_at %}&scheduled_at={{ filter_scheduled_at }}{% endif %}"
        class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition"
        onclick="saveScrollPosition()">
        &laquo; Previous
      </a>
      {% else %}
      <span class="px-3 py-2 bg-gray-100 text-gray-400 rounded cursor-not-allowed">
        &laquo; Previous
      </span>
      {% endif %}

      <!-- Page Numbers -->
      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <span class="px-3 py-2 bg-[#EF715C] text-white rounded font-semibold">
            {{ num }}
          </span>
          {% else %}
          <a href="{% url 'active_jobs_list' %}?page={{ num }}{% if filter_status %}&status={{ filter_status }}{% endif %}{% if filter_category %}&category={{ filter_category }}{% endif %}{% if filter_priority %}&priority={{ filter_priority }}{% endif %}{% if filter_trader %}&trader={{ filter_trader|urlencode }}{% endif %}{% if filter_scheduled_at %}&scheduled_at={{ filter_scheduled_at }}{% endif %}"
            class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition"
            onclick="saveScrollPosition()">
            {{ num }}
          </a>
        {% endif %}
      {% endfor %}

      <!-- Next Button -->
      {% if page_obj.has_next %}
      <a href="{% url 'active_jobs_list' %}?page={{ page_obj.next_page_number }}{% if filter_status %}&status={{ filter_status }}{% endif %}{% if filter_category %}&category={{ filter_category }}{% endif %}{% if filter_priority %}&priority={{ filter_priority }}{% endif %}{% if filter_trader %}&trader={{ filter_trader|urlencode }}{% endif %}{% if filter_scheduled_at %}&scheduled_at={{ filter_scheduled_at }}{% endif %}"
        class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition"
        onclick="saveScrollPosition()">
        Next &raquo;
      </a>
      {% else %}
      <span class="px-3 py-2 bg-gray-100 text-gray-400 rounded cursor-not-allowed">
        Next &raquo;
      </span>
      {% endif %}
    </div>
  {% endif %}

  <!-- Mobile Kanban layout -->
  <div class="sm:hidden space-y-4">
    {% for job in jobs %}
        <div class="bg-white rounded-xl shadow border border-gray-200 p-4">
          <div class="mb-2">
            <p class="text-xs text-gray-500 font-medium">Job Code</p>
            <p class="text-base font-semibold text-blue-900">{{ job.job_code }}</p>
          </div>
          <div class="mb-2">
            <p class="text-xs text-gray-500 font-medium">Renter</p>
            <p class="text-sm text-gray-800">{{ job.renter }}</p>
          </div>
          <div class="mb-2">
            <p class="text-xs text-gray-500 font-medium">Trader</p>
            <p class="text-sm text-gray-800">{{ job.trader }}</p>
          </div>
          <div class="mb-2">
            <p class="text-xs text-gray-500 font-medium">Status</p>
            <p class="text-sm text-gray-800">{{ job.get_status_display }}</p>
          </div>
          <div class="mb-2">
            <p class="text-xs text-gray-500 font-medium">Priority</p>
            {% if job.priority %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">High</span>
            {% else %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-800">Normal</span>
            {% endif %}
          </div>
          <div>
            <p class="text-xs text-gray-500 font-medium">Scheduled</p>
            <p class="text-sm text-gray-800">{{ job.scheduled_at|date:"Y-m-d H:i" }}</p>
          </div>
        </div>
    {% empty %}
        <div class="text-center text-gray-500 py-6">No active jobs found.</div>
    {% endfor %}
  </div>
</div>
</main>

{% include 'components/footerAgent.html' %}
{% endblock %}
