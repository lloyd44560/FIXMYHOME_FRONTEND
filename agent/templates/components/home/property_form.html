{% extends "baseAgent.html" %}
{% load widget_tweaks %}

{% block content %}
<!-- Top Navigation -->
{% include 'components/home/navigatorBaseAgent.html' %}

<div class="max-w-2xl mx-auto mt-10 bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full">
  <h2 class="text-3xl font-bold text-center text-blue-800 mb-8">
    {% if form.instance.pk %}Edit Property{% else %}Create Property{% endif %}
  </h2>

  <form method="POST" class="space-y-6" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="gap-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Property Name</label>
        {{ form.name|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
        <label class="block text-sm font-medium text-gray-700 mb-1 mt-4">Property ID</label>
        {{ form.property_id|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Street</label>
            {{ form.street|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">House Number</label>
            {{ form.house_number|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
          </div>
        </div>
        <label class="block text-sm font-medium text-gray-700 mb-1 mt-4">Address</label>
        {{ form.address|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
        <label class="block text-sm font-medium text-gray-700 mb-1 mt-4">Key Number</label>
        {{ form.key_number|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 items-end">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Renter Name</label>
        {{ form.renter_name|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
        {% if form.renter_name.errors %}
          <p class="text-sm text-red-600 mt-1">{{ form.renter_name.errors.0 }}</p>
        {% endif %}
      </div>
         <div class="flex sm:justify-start justify-end">
            <a href="{% if form.instance.id %}{% url 'renter_invitation' %}?name={{ form.renter_name.value|urlencode }}&email={{ form.renter_contact.value|urlencode }}&property_id={{ form.instance.id|urlencode }}&property_name={{ form.name.value|urlencode }}&property_address={{ form.address.value|urlencode }}&property_lease_start={{ form.lease_start.value|date:'m/d/Y'|urlencode }}&property_lease_end={{ form.lease_end.value|date:'m/d/Y'|urlencode }}&property_rent={{ form.rent.value|urlencode }}&property_status={{ form.status.value|urlencode }}{% else %}#{% endif %}"
               class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition shadow {% if not form.renter_name.value or not form.renter_contact.value or not form.instance.id %}opacity-50 pointer-events-none{% endif %}">
                Send Invitation
            </a>
        </div>
    </div>
    {% if request.user.is_authenticated and request.user.agentregister.is_admin %}
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Property Manager</label>
        {{ form.property_manager|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
    </div>
    {% endif %}

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1 mt-4">Upload Photo</label>
      {{ form.property_photo|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      <!-- Image Preview -->
      <img id="previewImage" src="#" alt="Preview" style="display:none; max-width: 200px; margin-top: 10px;" />
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Renter Contact</label>
      {{ form.renter_contact|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Lease Start</label>
        {{ form.lease_start|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Lease End</label>
        {{ form.lease_end|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Rent</label>
        {{ form.rent|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        {{ form.status|add_class:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" }}
      </div>
    </div>

    <div class="flex justify-end gap-3 pt-4">
      <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition shadow">
        Save
      </button>
      <a href="javascript:history.back()" class="text-gray-600 hover:text-blue-700 px-4 py-2 text-sm">
        Cancel
      </a>
    </div>
  </form>
</div>

{% include 'components/footerAgent.html' %}
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
    const photoInput = document.getElementById('id_property_photo');
    const preview = document.getElementById('previewImage');

    photoInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file && file.type.startsWith('image/')) {
            preview.src = URL.createObjectURL(file);
            preview.style.display = 'block';
        } else {
            preview.src = '';
            preview.style.display = 'none';
        }
    });
</script>
{% endblock %}
