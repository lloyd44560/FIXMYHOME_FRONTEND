{% extends "baseAgent.html" %}

{% block content %}
<!-- Top Navigation -->
{% include 'components/home/navigatorBaseAgent.html' %}


<main class="max-w-6xl mx-auto p-4 sm:p-6 mb-[8rem] flex-1 w-full">
  <h2 class="text-2xl sm:text-3xl font-bold text-blue-800 mb-6 text-center tracking-tight">Quotation for Your Job</h2>
  <!-- Filter Form -->
  <form method="GET" class="mb-6">
    <div class="flex flex-col md:flex-row gap-4">
      <!-- Status Filter -->
      <div>
        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
        <select name="status" id="status" class="mt-1 p-2 border rounded-md w-full md:w-40" onchange="this.form.submit()">
          {% for key, label in status_options.items %}
            <option value="{{ key }}" {% if key == filter_is_approved %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
      </select>
      </div>
      <!-- Approved At Filter -->
      <div>
        <label for="priority" class="block text-sm font-medium text-gray-700">Approved At</label>
        <input type="date" name="approved_at" id="approved_at" class="mt-1 p-2 border rounded-md w-full md:w-40" value="{{ filter_approved_at }}" onchange="this.form.submit()">
      </div>
      <!-- Trader Filter -->
      <div>
        <label for="trader" class="block text-sm font-medium text-gray-700">Trader</label>
        <input type="text" name="trader" id="trader" value="{{ filter_trader }}"
          class="mt-1 p-2 border rounded-md w-full md:w-40"
          placeholder="Enter trader"
          onchange="this.form.submit()">
      </div>
    </div>
  </form>

  <div class="space-y-4">
      <!-- Table layout for large screens -->
      <div class="hidden lg:block overflow-x-auto rounded-xl shadow">
        <table class="min-w-full bg-white border border-gray-200 rounded-xl overflow-hidden">
          <thead class="bg-blue-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Job</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Trader</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Team Member</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Created</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Status</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for bid in bids %}
            <tr class="border-t border-gray-100 hover:bg-blue-50 transition">
              <td class="px-4 py-3 whitespace-nowrap">{{ bid.jobs }}</td>
              <td class="px-4 py-3 whitespace-nowrap">{{ bid.trader }}</td>
              <td class="px-4 py-3 whitespace-nowrap">
                {% for member in bid.team_member.all %}
                  <div>{{ member.teamName }} ({{ member.position }})</div>
                {% empty %}
                  <span class="text-gray-400 italic">No team members</span>
                {% endfor %}
              </td>
              <td class="px-4 py-3 whitespace-nowrap">{{ bid.created_at|date:"Y-m-d H:i" }}</td>
              <td class="px-4 py-3">
                {% if bid.is_approved is None %}
                  <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-yellow-100 text-yellow-800">Pending</span>
                {% elif bid.is_approved %}
                  <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800">Approved</span>
                {% else %}
                  <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">Rejected</span>
                {% endif %}
              </td>
              <td class="px-4 py-3">
                <a href="{% url 'bidding_approval' bid.pk %}" class="inline-block bg-[#293272] text-white px-4 py-2 rounded-lg font-semibold hover:bg-[#162060] shadow transition">Review</a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center py-4">No bids found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Card layout for mobile -->
      <div class="lg:hidden space-y-4">
        {% for bid in bids %}
        <div class="bg-white rounded-xl shadow p-4 border border-gray-200">
          <div class="mb-2">
            <p class="text-sm text-gray-500 font-medium">Job</p>
            <p class="text-base font-semibold text-gray-800">{{ bid.jobs }}</p>
          </div>
          <div class="mb-2">
            <p class="text-sm text-gray-500 font-medium">Trader</p>
            <p class="text-base text-gray-800">{{ bid.trader }}</p>
          </div>
          <div class="mb-2">
            <p class="text-sm text-gray-500 font-medium">Team Member</p>
            {% for member in bid.team_member.all %}
              <div>{{ member.teamName }} ({{ member.position }})</div>
            {% empty %}
              <span class="text-gray-400 italic">No team members</span>
            {% endfor %}
          </div>
          <div class="mb-2">
            <p class="text-sm text-gray-500 font-medium">Created</p>
            <p class="text-base text-gray-800">{{ bid.created_at|date:"Y-m-d H:i" }}</p>
          </div>
          <div class="mb-2">
            <p class="text-sm text-gray-500 font-medium">Status</p>
            {% if bid.is_approved is None %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-yellow-100 text-yellow-800">Pending</span>
            {% elif bid.is_approved %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800">Approved</span>
            {% else %}
              <span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">Rejected</span>
            {% endif %}
          </div>
          <div class="mt-4">
            <a href="{% url 'bidding_approval' bid.pk %}" class="inline-block bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 shadow transition w-full text-center">Review</a>
          </div>
        </div>
        {% empty %}
        <div class="text-center py-4 text-gray-500">No bids found.</div>
        {% endfor %}
      </div>
    </div>

  {% if messages %}
    <div
      x-data="{ show: true }"
      x-init="setTimeout(() => show = false, 4000)"
      x-show="show"
      class="fixed top-6 right-6 z-50 bg-green-500 text-white px-4 py-2 rounded shadow-md transition ease-in-out"
    >
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
  {% endif %}

</main>

{% include 'components/footerAgent.html' %}
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endblock %}
